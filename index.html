<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Hyderabad Electronics Interactive Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<style>
#map { height: 90vh; }
.controls { padding: 10px; background: white; }
</style>
</head>

<body>

<div class="controls">
    Rating:
    <select id="ratingFilter">
        <option value="all">All</option>
        <option value="0-1">0–1</option>
        <option value="1-2">1–2</option>
        <option value="2-3">2–3</option>
        <option value="3-4">3–4</option>
        <option value="4-5">4–5</option>
    </select>

    Reviews:
    <select id="reviewFilter">
        <option value="all">All</option>
        <option value="0-10"><10</option>
        <option value="10-100">10–100</option>
        <option value="100-500">100–500</option>
        <option value="500-1000">500–1000</option>
        <option value="1000-5000">1000–5000</option>
        <option value="5000+">5000+</option>
    </select>

    <button onclick="updateMarkers()">GO</button>

    <span id="resultCount" style="margin-left:15px;font-weight:bold;"></span>
</div>

<div id="map"></div>

<script>

var map = L.map('map').setView([17.3850, 78.4867], 11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
}).addTo(map);

var markers = L.markerClusterGroup();
var allData = [];

// Load JSON
fetch("hyderabad_electronics.json")
.then(response => response.json())
.then(data => {
    allData = data;
    updateMarkers();  // initial load
});

function updateMarkers() {

    markers.clearLayers();

    var ratingFilter = document.getElementById("ratingFilter").value;
    var reviewFilter = document.getElementById("reviewFilter").value;

    var count = 0;

    allData.forEach(store => {

        var rating = parseFloat(store.rating) || 0;
        var reviews = parseInt(store.reviews) || 0;

        if (!ratingPass(rating, ratingFilter)) return;
        if (!reviewPass(reviews, reviewFilter)) return;

        var marker = L.marker([store.lat, store.lng])
            .bindPopup(
                "<b>" + store.name + "</b><br>" +
                "Rating: " + rating + "<br>" +
                "Reviews: " + reviews
            );

        markers.addLayer(marker);
        count++;
    });

    map.addLayer(markers);

    document.getElementById("resultCount").innerText =
        "Showing: " + count + " stores";
}

function ratingPass(rating, filter) {
 if (filter === "all") return true;

    var parts = filter.split("-");
    var min = parseFloat(parts[0]);
    var max = parseFloat(parts[1]);

    return rating > min && rating <= max;
}

function reviewPass(reviews, filter) {
    if (filter === "all") return true;

    if (filter === "5000+") return reviews > 5000;

    var parts = filter.split("-");
    var min = parseInt(parts[0]);
    var max = parseInt(parts[1]);

    return reviews > min && reviews <= max;
}
</script>

</body>
</html>

